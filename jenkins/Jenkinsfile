pipeline {
	agent none
    stages {

        stage('Build') {
			agent {
	        	docker {
	        	    image 'maven:3-alpine'
	        	    args '-u root'
		    	    }
		    }
            steps {
                sh 'mvn -B -DskipTests clean package'
                sh 'mvn test'
				sh './jenkins/scripts/deliver.sh'
				stash includes: 'Pipeline/target/my-app-1.0-SNAPSHOT.jar', name: 'ARTEFACT'
            }
		}
		stage('Build image') {
			agent{ label 'master'}
			steps {	
				unstash name: 'ARTEFACT'	
				sh "docker ps"
			}	
	  	}
  }
}
