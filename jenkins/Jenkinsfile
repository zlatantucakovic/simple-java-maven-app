pipeline {
	agent none
    stages {

        stage('Build') {
			agent {
	        	docker {
	        	    image 'maven:3-alpine'
	        	    args '-u root'
		    	}
		    }
            steps {
                sh 'mvn -B -DskipTests clean package'
                sh 'mvn test'
				sh './jenkins/scripts/deliver.sh'
				stash includes: 'target/my-app-1.0-SNAPSHOT.jar', name: 'ARTEFACT'
            }
		}
		stage('Build image') {
			agent{ label 'master'}
			steps {
				dir("ARTEFACT"){	
					unstash 'ARTEFACT'
				}
				sh "ls -la ${pwd()}"
				sh "ls -la ${pwd()}/ARTEFACT"
				script{
					docker.build "jovan:1.0"				
				}
			}	
	  	}
	}
}
